# Settings Modal 测试指南

## 本地测试

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 测试场景

#### 场景 1: 正常访问（最重要）
1. 访问 `http://localhost:5173/`
2. **预期结果**: 设置弹窗不会自动显示
3. **验证**: 页面正常显示，没有弹窗遮挡

#### 场景 2: 点击设置按钮
1. 点击页面上的设置按钮（齿轮图标）
2. **预期结果**: 设置弹窗打开，URL 变为 `/#settings`
3. **验证**: 弹窗正常显示，可以查看和修改设置

#### 场景 3: 关闭弹窗
测试以下三种关闭方式：
- 点击右上角的 X 按钮
- 点击弹窗外部的黑色遮罩区域
- 按键盘 ESC 键

**预期结果**: 弹窗关闭，URL 恢复为 `/`

#### 场景 4: 直接访问设置
1. 访问 `http://localhost:5173/#settings`
2. **预期结果**: 页面加载后自动打开设置弹窗
3. **验证**: 弹窗自动显示

#### 场景 5: 浏览器前进/后退
1. 打开设置弹窗（URL 变为 `/#settings`）
2. 关闭弹窗（URL 变为 `/`）
3. 点击浏览器的后退按钮
4. **预期结果**: 设置弹窗重新打开
5. 点击浏览器的前进按钮
6. **预期结果**: 设置弹窗关闭

#### 场景 6: 刷新页面
1. 打开设置弹窗（URL 为 `/#settings`）
2. 刷新页面（F5 或 Ctrl+R）
3. **预期结果**: 设置弹窗保持打开状态

## Netlify 部署测试

### 部署前检查
```bash
# 确保构建成功
npm run build

# 检查 dist 目录
ls -la dist/
```

### 部署到 Netlify
```bash
# 如果使用 Netlify CLI
netlify deploy --prod --dir=dist

# 或者通过 Git 推送自动部署
git add .
git commit -m "fix: 优化设置弹窗，防止意外弹出"
git push origin main
```

### 生产环境测试
在 Netlify 部署完成后，重复上述所有测试场景。

**特别注意场景 1**: 这是最关键的测试，确保首次访问时设置弹窗不会自动弹出。

## 预期行为总结

### ✅ 正确行为
- 首次访问网站，设置弹窗不显示
- 只有在以下情况才显示弹窗：
  - 用户点击设置按钮
  - URL 包含 `#settings` hash
- 弹窗可以通过多种方式关闭
- URL hash 与弹窗状态保持同步

### ❌ 错误行为（已修复）
- ~~首次访问时自动弹出设置弹窗~~
- ~~无法通过 URL 控制弹窗状态~~
- ~~关闭弹窗后 URL 不更新~~

## 故障排查

### 如果设置弹窗仍然意外弹出

1. **清除浏览器缓存**
   - Chrome: Ctrl+Shift+Delete
   - 选择"缓存的图片和文件"
   - 清除数据

2. **清除 localStorage**
   - 打开浏览器开发者工具（F12）
   - 进入 Application/Storage 标签
   - 找到 Local Storage
   - 删除所有相关数据

3. **检查 URL**
   - 确保访问的是 `/` 而不是 `/#settings`
   - 检查是否有其他 hash 参数

4. **检查构建文件**
   ```bash
   # 重新构建
   npm run build
   
   # 验证构建成功
   ls -la dist/assets/main-*.js
   ```

5. **检查 Netlify 部署**
   - 确认部署的是最新版本
   - 检查 Netlify 的部署日志
   - 验证文件是否正确上传

## 技术支持

如果问题仍然存在，请提供以下信息：
1. 浏览器类型和版本
2. 访问的完整 URL
3. 浏览器控制台的错误信息（F12 -> Console）
4. 网络请求日志（F12 -> Network）

## 更新记录

- 2025-12-08: 初始版本，修复设置弹窗意外弹出问题

