# ğŸ”§ Cloudflare Pages éƒ¨ç½²é”™è¯¯ä¿®å¤

## âŒ åŸå§‹é”™è¯¯

```
âœ˜ [ERROR] The expected output file at "workers-site/index.js" was not found after running custom build: npm run build.

The `main` property in your wrangler.toml file should point to the file generated by the custom build.
```

---

## ğŸ¯ é—®é¢˜åŸå› 

æ‚¨çš„é¡¹ç›®æ˜¯ **Cloudflare Pages**ï¼ˆé™æ€ç½‘ç«™ï¼‰ï¼Œä½† `wrangler.toml` æ–‡ä»¶é…ç½®æˆäº† **Cloudflare Workers Sites** æ¨¡å¼ã€‚

**åŒºåˆ«**:
- **Cloudflare Pages**: é™æ€ç½‘ç«™æ‰˜ç®¡ï¼Œä¸éœ€è¦ Workers ä»£ç 
- **Workers Sites**: éœ€è¦ `workers-site/index.js` æ–‡ä»¶æ¥å¤„ç†è¯·æ±‚

---

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. åˆ é™¤äº† `wrangler.toml`
- âŒ æ—§é…ç½®åŒ…å« `[site]` å’Œ `[build]` éƒ¨åˆ†ï¼Œå¯¼è‡´ Wrangler å¯»æ‰¾ä¸å­˜åœ¨çš„ `workers-site/index.js`
- âœ… Cloudflare Pages **ä¸éœ€è¦** `wrangler.toml` æ–‡ä»¶
- âœ… æ‰€æœ‰é…ç½®å·²ç§»è‡³ `public/_headers` å’Œ `public/_redirects`

### 2. æ›´æ–°äº†éƒ¨ç½²å‘½ä»¤
- âŒ æ—§å‘½ä»¤: `wrangler deploy` (Workers å‘½ä»¤)
- âœ… æ–°å‘½ä»¤: `wrangler pages deploy dist` (Pages å‘½ä»¤)

---

## ğŸš€ æ­£ç¡®çš„éƒ¨ç½²æ–¹æ³•

### æ–¹æ³• 1: Cloudflare Dashboardï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰

1. **è®¿é—® Cloudflare Dashboard**
   - https://dash.cloudflare.com/
   - è¿›å…¥ **Pages** éƒ¨åˆ†

2. **åˆ›å»ºæ–°é¡¹ç›®**
   - ç‚¹å‡» **Create a project**
   - é€‰æ‹© **Connect to Git**

3. **è¿æ¥ä»“åº“**
   - æˆæƒ GitHub/GitLab
   - é€‰æ‹© `freetopdf` ä»“åº“

4. **é…ç½®æ„å»ºè®¾ç½®**
   ```
   Framework preset:      None (æˆ–é€‰æ‹© Vite)
   Build command:         npm run build
   Build output directory: dist
   Root directory:        / (ç•™ç©º)
   ```

5. **ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰**
   - æ·»åŠ : `NODE_VERSION` = `22.16.0`

6. **éƒ¨ç½²**
   - ç‚¹å‡» **Save and Deploy**
   - ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦ 40-60 ç§’ï¼‰

âœ… **è¿™æ˜¯æ¨èçš„æ–¹å¼ï¼** ä¹‹åæ¯æ¬¡ push ä»£ç éƒ½ä¼šè‡ªåŠ¨éƒ¨ç½²ã€‚

---

### æ–¹æ³• 2: Wrangler CLIï¼ˆæ‰‹åŠ¨éƒ¨ç½²ï¼‰

å¦‚æœæ‚¨æƒ³é€šè¿‡å‘½ä»¤è¡Œéƒ¨ç½²ï¼š

```bash
# 1. å®‰è£… Wrangler (å…¨å±€)
npm install -g wrangler

# 2. ç™»å½• Cloudflare
wrangler login

# 3. æ„å»ºé¡¹ç›®
npm run build

# 4. éƒ¨ç½²åˆ° Pages (é¦–æ¬¡ä¼šæç¤ºåˆ›å»ºé¡¹ç›®)
npx wrangler pages deploy dist

# æŒ‰ç…§æç¤ºæ“ä½œ:
# - è¾“å…¥é¡¹ç›®åç§°: pdftoolkit
# - é€‰æ‹©ç”Ÿäº§åˆ†æ”¯: main
```

**åç»­éƒ¨ç½²**:
```bash
npm run build
npm run pages:deploy
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [x] âœ… åˆ é™¤äº† `wrangler.toml` æ–‡ä»¶
- [x] âœ… `public/_headers` æ–‡ä»¶å­˜åœ¨
- [x] âœ… `public/_redirects` æ–‡ä»¶å­˜åœ¨
- [x] âœ… `.node-version` æ–‡ä»¶å­˜åœ¨
- [ ] â¬œ ä»£ç å·²æ¨é€åˆ° Git ä»“åº“
- [ ] â¬œ æœ¬åœ°æ„å»ºæµ‹è¯•é€šè¿‡: `npm run build`

è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š
```bash
npm run cloudflare:check
```

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸçš„æ ‡å¿—

æ„å»ºæ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š

```
âœ“ 2031 modules transformed.
âœ“ built in XX.XXs
Success: Build command completed
Successfully deployed to: https://xxx.pages.dev
```

**ä¸åº”è¯¥å†çœ‹åˆ°**:
- âŒ "workers-site/index.js" é”™è¯¯
- âŒ "wrangler.toml" è­¦å‘Š

---

## ğŸ” ä¸ºä»€ä¹ˆåˆ é™¤ wrangler.tomlï¼Ÿ

| æ–‡ä»¶ | ç”¨é€” | æ˜¯å¦éœ€è¦ |
|------|------|----------|
| `wrangler.toml` | Workers/Workers Sites é…ç½® | âŒ **ä¸éœ€è¦**ï¼ˆPages é¡¹ç›®ï¼‰ |
| `public/_headers` | HTTP headers (CORS, ç¼“å­˜ç­‰) | âœ… **éœ€è¦** |
| `public/_redirects` | SPA è·¯ç”±é‡å®šå‘ | âœ… **éœ€è¦** |
| `.node-version` | Node.js ç‰ˆæœ¬ | âœ… **éœ€è¦** |

**Cloudflare Pages çš„é…ç½®æ–¹å¼**:
- Headers: ä½¿ç”¨ `public/_headers` æ–‡ä»¶
- Redirects: ä½¿ç”¨ `public/_redirects` æ–‡ä»¶
- Build è®¾ç½®: åœ¨ Dashboard æˆ–é¦–æ¬¡ CLI éƒ¨ç½²æ—¶é…ç½®

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¹‹å‰æœ‰ wrangler.tomlï¼Ÿ
**A**: å¯èƒ½æ˜¯ä» Workers Sites æ¨¡æ¿å¤åˆ¶çš„ï¼Œæˆ–è€…è¯¯ç”¨äº† Workers é…ç½®ã€‚

### Q2: Headers é…ç½®å»å“ªäº†ï¼Ÿ
**A**: å·²ç»åœ¨ `public/_headers` æ–‡ä»¶ä¸­ï¼ŒCloudflare Pages ä¼šè‡ªåŠ¨è¯»å–ã€‚

### Q3: å¯ä»¥ç”¨ wrangler pages deploy å—ï¼Ÿ
**A**: å¯ä»¥ï¼è¿è¡Œ `npm run pages:deploy` å³å¯ã€‚ä½†æ¨èç”¨ Dashboard å®ç°è‡ªåŠ¨éƒ¨ç½²ã€‚

### Q4: éœ€è¦é‡æ–°é…ç½®å—ï¼Ÿ
**A**: ä¸éœ€è¦ï¼æ‰€æœ‰é…ç½®å·²å®Œæˆï¼Œç›´æ¥éƒ¨ç½²å³å¯ã€‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æäº¤æ›´æ”¹**
   ```bash
   git add .
   git commit -m "Fix: Remove wrangler.toml for Cloudflare Pages deployment"
   git push
   ```

2. **åœ¨ Cloudflare Dashboard éƒ¨ç½²**
   - æŒ‰ç…§ä¸Šé¢"æ–¹æ³• 1"çš„æ­¥éª¤æ“ä½œ
   - æˆ–è€…ä½¿ç”¨ `wrangler pages deploy dist`

3. **éªŒè¯éƒ¨ç½²**
   - è®¿é—®ä½ çš„ Pages URL
   - æµ‹è¯•è¯­è¨€åˆ‡æ¢åŠŸèƒ½
   - æµ‹è¯• PDF å·¥å…·

---

## âœ… ä¿®å¤å®Œæˆï¼

æ‰€æœ‰é…ç½®å·²æ›´æ–°ï¼Œé”™è¯¯å·²ä¿®å¤ã€‚ç°åœ¨å¯ä»¥æ­£å¸¸éƒ¨ç½²åˆ° Cloudflare Pages äº†ï¼

**ä¿®å¤æ—¶é—´**: 2025-12-07
**é”™è¯¯ç±»å‹**: Workers Sites vs Pages é…ç½®æ··æ·†
**è§£å†³æ–¹æ¡ˆ**: åˆ é™¤ wrangler.tomlï¼Œä½¿ç”¨ Pages æ ‡å‡†é…ç½®

