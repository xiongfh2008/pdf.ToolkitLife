<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFToolkit éƒ¨ç½²è¯Šæ–­å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 32px;
        }
        .subtitle {
            color: #718096;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .input-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            margin-bottom: 8px;
        }
        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        .btn:active {
            transform: translateY(0);
        }
        .results {
            margin-top: 30px;
            display: none;
        }
        .results.show {
            display: block;
        }
        .check-item {
            background: #f7fafc;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #cbd5e0;
            transition: all 0.3s;
        }
        .check-item.success {
            background: #f0fdf4;
            border-left-color: #22c55e;
        }
        .check-item.error {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        .check-item.warning {
            background: #fffbeb;
            border-left-color: #f59e0b;
        }
        .check-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .check-detail {
            color: #64748b;
            font-size: 14px;
            margin-left: 28px;
        }
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .summary-score {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin-top: 12px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” PDFToolkit éƒ¨ç½²è¯Šæ–­å·¥å…·</h1>
        <p class="subtitle">è‡ªåŠ¨æ£€æµ‹æœ¬åœ°å’Œéƒ¨ç½²ç‰ˆæœ¬çš„å·®å¼‚ï¼Œå¿«é€Ÿå®šä½é—®é¢˜</p>
        
        <div class="input-group">
            <label for="localUrl">æœ¬åœ°é¢„è§ˆåœ°å€</label>
            <input type="text" id="localUrl" placeholder="http://localhost:4173" value="http://localhost:4173">
        </div>
        
        <div class="input-group">
            <label for="productionUrl">ç”Ÿäº§ç¯å¢ƒåœ°å€</label>
            <input type="text" id="productionUrl" placeholder="https://pdf.voguegale.com" value="https://pdf.voguegale.com">
        </div>
        
        <button class="btn" onclick="runDiagnostic()">å¼€å§‹è¯Šæ–­</button>
        
        <div id="results" class="results">
            <!-- ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>

    <script>
        async function runDiagnostic() {
            const localUrl = document.getElementById('localUrl').value;
            const productionUrl = document.getElementById('productionUrl').value;
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.className = 'results show';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>æ­£åœ¨è¯Šæ–­...</p></div>';
            
            const results = {
                local: await checkEnvironment(localUrl, 'æœ¬åœ°'),
                production: await checkEnvironment(productionUrl, 'ç”Ÿäº§')
            };
            
            displayResults(results);
        }
        
        async function checkEnvironment(baseUrl, name) {
            const checks = {
                name,
                baseUrl,
                accessible: false,
                hasLanguageSwitcher: false,
                hasToolCards: false,
                hasAlertModal: false,
                alertModalHidden: false,
                scriptsLoaded: [],
                stylesLoaded: [],
                errors: [],
                mainJsSize: 0
            };
            
            try {
                // ç”±äºCORSé™åˆ¶ï¼Œæˆ‘ä»¬åªèƒ½æä¾›è¯Šæ–­ä»£ç 
                // ç”¨æˆ·éœ€è¦åœ¨æµè§ˆå™¨Consoleä¸­è¿è¡Œ
                checks.accessible = true;
                checks.instructions = `è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ ${baseUrl}ï¼Œç„¶ååœ¨Consoleä¸­è¿è¡Œä»¥ä¸‹ä»£ç ï¼š`;
            } catch (error) {
                checks.errors.push(error.message);
            }
            
            return checks;
        }
        
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            
            const diagnosticCode = `
// === PDFToolkit è¯Šæ–­ä»£ç  ===
// è¯·åˆ†åˆ«åœ¨æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒçš„Consoleä¸­è¿è¡Œ

(async function() {
    console.clear();
    const results = {
        url: window.location.href,
        timestamp: new Date().toISOString()
    };
    
    // 1. æ£€æŸ¥DOMå…ƒç´ 
    results.languageSwitcher = !!document.getElementById('language-switcher-desktop');
    results.toolCards = document.querySelectorAll('.tool-card').length;
    results.alertModal = !!document.getElementById('alert-modal');
    results.alertModalHidden = document.getElementById('alert-modal')?.classList.contains('hidden');
    
    // 2. æ£€æŸ¥è„šæœ¬
    results.scripts = Array.from(document.scripts)
        .filter(s => s.src)
        .map(s => ({
            name: s.src.split('/').pop(),
            loaded: true
        }));
    
    // 3. æ£€æŸ¥æ ·å¼
    results.styles = Array.from(document.styleSheets)
        .map(s => s.href?.split('/').pop() || 'inline')
        .filter(s => s !== 'inline');
    
    // 4. æ£€æŸ¥main.jså¤§å°
    const mainScript = Array.from(document.scripts).find(s => s.src.includes('main-'));
    if (mainScript) {
        try {
            const response = await fetch(mainScript.src, { cache: 'no-store' });
            const text = await response.text();
            results.mainJsSize = Math.round(text.length / 1024);
            results.hasLanguageSwitcherCode = text.includes('LanguageSwitcher');
        } catch (e) {
            results.mainJsError = e.message;
        }
    }
    
    // 5. æ£€æŸ¥Consoleé”™è¯¯
    results.consoleErrors = window.__errors || [];
    
    console.log('=== è¯Šæ–­ç»“æœ ===');
    console.table(results);
    console.log('\\nè¯·å°†æ­¤ç»“æœæˆªå›¾æˆ–å¤åˆ¶ç»™å¼€å‘è€…');
    
    return results;
})();
            `.trim();
            
            resultsDiv.innerHTML = `
                <div class="summary">
                    <div class="summary-score">ğŸ“‹</div>
                    <h2>è¯Šæ–­æ­¥éª¤</h2>
                    <p>ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤</p>
                </div>
                
                <div class="check-item">
                    <div class="check-title">
                        <span class="icon">1ï¸âƒ£</span>
                        <span>æœ¬åœ°ç¯å¢ƒæ£€æŸ¥</span>
                    </div>
                    <div class="check-detail">
                        æ‰“å¼€ <a href="${results.local.baseUrl}" target="_blank" style="color: #667eea; font-weight: 600;">${results.local.baseUrl}</a>
                        <br>æŒ‰ F12 â†’ Console â†’ å¤åˆ¶ç²˜è´´ä»¥ä¸‹ä»£ç  â†’ å›è½¦
                        <div class="code-block">${diagnosticCode}</div>
                    </div>
                </div>
                
                <div class="check-item">
                    <div class="check-title">
                        <span class="icon">2ï¸âƒ£</span>
                        <span>ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥</span>
                    </div>
                    <div class="check-detail">
                        æ‰“å¼€æ— ç—•çª—å£ï¼ˆCtrl + Shift + Nï¼‰
                        <br>è®¿é—® <a href="${results.production.baseUrl}" target="_blank" style="color: #667eea; font-weight: 600;">${results.production.baseUrl}</a>
                        <br>æŒ‰ F12 â†’ Console â†’ å¤åˆ¶ç²˜è´´ç›¸åŒä»£ç  â†’ å›è½¦
                        <div class="code-block">${diagnosticCode}</div>
                    </div>
                </div>
                
                <div class="check-item warning">
                    <div class="check-title">
                        <span class="icon">3ï¸âƒ£</span>
                        <span>å¯¹æ¯”ç»“æœ</span>
                    </div>
                    <div class="check-detail">
                        æ¯”è¾ƒä¸¤æ¬¡è¿è¡Œçš„ç»“æœï¼Œé‡ç‚¹å…³æ³¨ï¼š
                        <ul style="margin-left: 28px; margin-top: 8px; color: #64748b;">
                            <li>languageSwitcher: åº”è¯¥éƒ½æ˜¯ true</li>
                            <li>toolCards: åº”è¯¥éƒ½ > 0</li>
                            <li>alertModalHidden: åº”è¯¥éƒ½æ˜¯ true</li>
                            <li>mainJsSize: åº”è¯¥æ¥è¿‘ï¼ˆçº¦20KBï¼‰</li>
                            <li>hasLanguageSwitcherCode: åº”è¯¥éƒ½æ˜¯ true</li>
                        </ul>
                    </div>
                </div>
                
                <div class="check-item error">
                    <div class="check-title">
                        <span class="icon">âš ï¸</span>
                        <span>å¸¸è§é—®é¢˜</span>
                    </div>
                    <div class="check-detail">
                        <strong>å¦‚æœç”Ÿäº§ç¯å¢ƒç»“æœå¼‚å¸¸ï¼š</strong>
                        <ul style="margin-left: 28px; margin-top: 8px; color: #64748b;">
                            <li><strong>mainJsSize ä¸º 0</strong> â†’ æµè§ˆå™¨ä½¿ç”¨äº†ç¼“å­˜ï¼Œéœ€è¦æ¸…é™¤ç¼“å­˜</li>
                            <li><strong>hasLanguageSwitcherCode ä¸º false</strong> â†’ éƒ¨ç½²çš„æ˜¯æ—§ç‰ˆæœ¬ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²</li>
                            <li><strong>toolCards ä¸º 0</strong> â†’ JavaScriptæ‰§è¡Œå¤±è´¥ï¼Œæ£€æŸ¥Consoleé”™è¯¯</li>
                            <li><strong>å‡ºç° CORS é”™è¯¯</strong> â†’ node:moduleé—®é¢˜æœªä¿®å¤ï¼Œéœ€è¦é‡æ–°æ„å»º</li>
                        </ul>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>

